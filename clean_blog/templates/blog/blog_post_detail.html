{% extends "base.html" %}
{# タグのload #}
{% load mezzanine_tags comment_tags keyword_tags rating_tags i18n future disqus_tags %}

{# ヘッダータイトル #}
{% block meta_title %}{{ blog_post.meta_title }}{% endblock %}

{# キーワード指定 #}
{% block meta_keywords %}
	{% metablock %}
		{% keywords_for blog_post as tags %}
		{% for tag in tags %}
			{% if not forloop.first %},{% endif %}{{ tag }}
		{% endfor %}
	{% endmetablock %}
{% endblock %}

{# descripstion #}
{% block meta_description %}
	{% metablock %}
		{{ blog_post.description }}
	{% endmetablock %}
{% endblock %}

{% block title %}
{% editable blog_post.title %}{{ blog_post.title }}{% endeditable %}
{% endblock %}

{# base.html のheading-textの処理を上書き #}
{% block heading-text %}
	{% editable blog_post.title %}{{ blog_post.title }}{% endeditable %}
{% endblock %}

{% block subheading-text %}
	{% editable blog_post.publish_date %}
	<div class="entry-meta-subheading">
        <span class="author">{% with blog_post.user as author %}
		<a href="{% url "blog_post_list_author" author %}">{{ author.get_full_name|default:author.username }}</a>
		{% endwith %}
		</span>
		{% with blog_post.categories.all as categories %}
		    {% if categories %}
	        <span class="divider">/</span>
	        <span>
				{% trans "in" %}
				{% for category in categories %}
				<a href="{% url "blog_post_list_category" category.slug %}">{{ category }}</a>{% if not forloop.last %}, {% endif %}
				{% endfor %}
			</span>
	        {% endif %}
        {% endwith %}
        <span class="divider">/</span>
        <span> {% blocktrans with sometime=blog_post.publish_date|timesince %}{{ sometime }} ago{% endblocktrans %}</span>
        <span class="divider">/</span>
        <span class="comment">
        {% if blog_post.allow_comments %}
			
			{% if settings.COMMENTS_DISQUS_SHORTNAME %}
			<a href="{{ blog_post.get_absolute_url }}#disqus_thread"
				data-disqus-identifier="{% disqus_id_for blog_post %}">
				{% trans "Comments" %}
			</a>
			{% else %}
			<a href="{{ blog_post.get_absolute_url }}#comments">
				{% blocktrans count comments_count=blog_post.comments_count %}{{ comments_count }} comment{% plural %}{{ comments_count }} comments{% endblocktrans %}
			</a>
			{% endif %}
		{% endif %}										
        </span>
	</div>
	{% endeditable %}
{% endblock %}

{% block breadcrumb_menu %}
{{ block.super }}
	<li class="active">{{ blog_post.title }}</li>
{% endblock %}

{# ----------------------------------------------------------------------------------#}
{# MAINBLOCK START#}
{# ------#}
{% block main %}
<section id="blog" class="container">
	<div class="row">
		<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
			<div class="blog">
				<div class="blog-item">
				 {% if settings.BLOG_USE_FEATURED_IMAGE and blog_post.featured_image %}
					{% block blog_post_list_post_featured_image %}
					<a href="{{ blog_post.get_absolute_url }}">
						<img width="100%" class="img-responsive img-blog" src="{{ MEDIA_URL }}{{blog_post.featured_image }}">
					</a>
					{% endblock %}
				 {% endif %}
					<div class="blog-content">
						{# ブログタイトルの出力箇所 #}
						{% block blog_post_list_post_title %}
						{% endblock %}

						{% block blog_post_list_post_metainfo %}
						{% endblock %}

						{% block blog_post_list_post_content %}
						{% editable blog_post.content %}
							{{ blog_post.content|richtext_filters|safe }}
						{% endeditable %}
						{% endblock %}
						
						{% block blog_post_list_post_links %}
							{% keywords_for blog_post as tags %}
						    {% if tags %}
								<div class="tags">
								  <i class="icon-tags"></i> {% trans "Tags" %}:
								    {% spaceless %}
								    {% for tag in tags %} 
								  	<a href="{% url "blog_post_list_tag" tag.slug %}" class="btn btn-xs btn-primary">{{ tag }}</a>
									{% endfor %}
								    {% endspaceless %}
								</div>
							{% endif %}
							{% block blog_post_detail_comments %}
								{% if blog_post.allow_comments %}
									{% comments_for blog_post %}
								{% endif %}
							{% endblock %}
						{% endblock %}
					</div>
				</div>
				{% include "blog/includes/google_adsense_blog_bottom.html" %}
				
				<div class="blog-item">
					{% load blog_tags keyword_tags mezzanine_tags i18n %}
					{% block blog_recent_posts %}
					{% blog_recent_posts 5 as recent_posts %}
					{% if recent_posts %}
					<h3>{% trans "Recent Posts" %}</h3>
					<ul class="recent-posts">
					{% for recent_post in recent_posts %}
					<li>
					    {% spaceless %}
					    <a href="{{ recent_post.get_absolute_url }}">
					        {% if settings.BLOG_USE_FEATURED_IMAGE and recent_post.featured_image %}
					        <img src="{{ MEDIA_URL }}{% thumbnail recent_post.featured_image 24 24 %}">
					        {% endif %}
					    {{ recent_post.title }}
					    </a>
					    {% endspaceless %}
					</li>
					{% endfor %}
					</ul>
					{% endif %}
					{% endblock %}

					{% block blog_months %}
					{% blog_months as months %}
					{% if months %}
					<h3>{% trans "Archive" %}</h3>
					{% for month in months %}
					    {% ifchanged month.date.year %}
					        {% if not forloop.first %}</ul>{% endif %}
					        <h4>{{ month.date.year }}</h4><ul>
					    {% endifchanged %}
					    <li><a href="{% url "blog_post_list_month" year=month.date.year month=month.date.month %}"
					        >{{ month.date|date:"F" }}</a> ({{ month.post_count }})</li>
					{% endfor %}
					</ul>
					{% endif %}
					{% endblock %}

					{% block blog_feeds %}
					<h3>{% trans "Feeds" %}</h3>
					<ul>
					<li>
					{% if tag %}
					    <a href="{% url "blog_post_feed_tag" tag.slug "rss" %}">{% trans "RSS" %}</a> /
					    <a href="{% url "blog_post_feed_tag" tag.slug "atom" %}">{% trans "Atom" %}</a>
					{% endif %}
					{% if category %}
					    <a href="{% url "blog_post_feed_category" category.slug "rss" %}">{% trans "RSS" %}</a> /
					    <a href="{% url "blog_post_feed_category" category.slug "atom" %}">{% trans "Atom" %}</a>
					{% endif %}
					{% if author %}
					    <a href="{% url "blog_post_feed_author" author.username "rss" %}">{% trans "RSS" %}</a> /
					    <a href="{% url "blog_post_feed_author" author.username "atom" %}">{% trans "Atom" %}</a>
					{% endif %}
					{% if not tag and not category and not author %}
					    <a href="{% url "blog_post_feed" "rss" %}">{% trans "RSS" %}</a> /
					    <a href="{% url "blog_post_feed" "atom" %}">{% trans "Atom" %}</a>
					{% endif %}
					</li>
					</ul>
					{% endblock %}
				</div>
			</div>
		</div>
	</div>
</section>
{% endblock %}
{# ----------------------------------------------------------------------------------#}
{# MAINBLOCK END#}
{# ------#}

{% block blog_post_detail_rating %}
<div class="panel panel-default rating">
    <div class="panel-body">
    {% rating_for blog_post %}
    </div>
</div>
{% endblock %}

{% block blog_post_detail_sharebuttons %}
{% set_short_url_for blog_post %}
<a class="btn btn-sm share-twitter" target="_blank" href="http://twitter.com/home?status={{ blog_post.short_url|urlencode }}%20{{ blog_post.title|urlencode }}">{% trans "Share on Twitter" %}</a>
<a class="btn btn-sm share-facebook" target="_blank" href="http://facebook.com/sharer.php?u={{ request.build_absolute_uri }}&amp;t={{ blog_post.title|urlencode }}">{% trans "Share on Facebook" %}</a>
{% endblock %}

{% block blog_post_previous_next %}
<ul class="pager">
{% with blog_post.get_previous_by_publish_date as previous %}
{% if previous %}
<li class="previous">
    <a href="{{ previous.get_absolute_url }}">&larr; {{ previous }}</a>
</li>
{% endif %}
{% endwith %}
{% with blog_post.get_next_by_publish_date as next %}
{% if next %}
<li class="next">
    <a href="{{ next.get_absolute_url }}">{{ next }} &rarr;</a>
</li>
{% endif %}
{% endwith %}
</ul>
{% endblock %}

{% block blog_post_detail_related_posts %}
{% if blog_post.related_posts.all %}
<div id="related-posts">
<h3>{% trans 'Related posts' %}</h3>
<ul class="list-unstyled">
{% for post in blog_post.related_posts.all %}
     <li><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></li>
{% endfor %}
</ul>
</div>
{% endif %}
{% endblock %}
